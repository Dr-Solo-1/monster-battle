<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Ù…Ù…Ø§Ù„Ùƒ Ø§Ù„Ø¸Ù„Ø§Ù„</title>
  <!-- Ø®Ø· Ø¹Ø±Ø¨ÙŠ Ø¬Ù…ÙŠÙ„ -->
  <link href="https://fonts.googleapis.com/css2?family=Tajawal:wght@400;700&display=swap" rel="stylesheet">
  <style>
    body {
      font-family: 'Tajawal', 'Segoe UI', Tahoma, sans-serif;
      background: linear-gradient(135deg, #0c1a25, #1a2a3a);
      color: #e0f7fa;
      text-align: center;
      padding: 15px;
      line-height: 1.6;
      margin: 0;
    }
    .container {
      max-width: 600px;
      margin: 0 auto;
      background: rgba(13, 27, 37, 0.85);
      padding: 20px;
      border-radius: 20px;
      box-shadow: 0 10px 30px rgba(0, 0, 0, 0.5);
      border: 1px solid #2a5d6b;
      backdrop-filter: blur(5px);
    }
    h1 {
      color: #ffd700;
      text-shadow: 0 0 15px rgba(255, 215, 0, 0.5);
      margin: 10px 0;
      font-size: 28px;
    }
    .subtitle {
      color: #a8e6cf;
      font-style: italic;
      margin-bottom: 20px;
      font-size: 16px;
    }
    button {
      background: linear-gradient(to bottom, #2a7d45, #1e5d32);
      color: white;
      border: none;
      padding: 10px 16px;
      margin: 6px 4px;
      border-radius: 12px;
      cursor: pointer;
      font-size: 15px;
      font-family: 'Tajawal', sans-serif;
      transition: all 0.3s ease;
      box-shadow: 0 4px 6px rgba(0,0,0,0.2);
    }
    button:hover {
      transform: translateY(-2px);
      box-shadow: 0 6px 8px rgba(0,0,0,0.3);
      background: linear-gradient(to bottom, #3cb371, #2a7d45);
    }
    .choice-btn {
      background: linear-gradient(to bottom, #5d4a7a, #4a3a60);
    }
    .zone-btn {
      background: linear-gradient(to bottom, #4a6b3f, #3a502f);
    }
    .stats {
      display: flex;
      flex-wrap: wrap;
      justify-content: space-around;
      background: rgba(10, 30, 40, 0.7);
      padding: 14px;
      margin: 15px 0;
      border-radius: 15px;
      border: 1px solid #2a5d6b;
      gap: 8px;
    }
    .stat-item {
      font-size: 14px;
    }
    .log {
      background: rgba(5, 20, 25, 0.7);
      height: 170px;
      overflow-y: auto;
      padding: 12px;
      border-radius: 15px;
      margin: 15px 0;
      text-align: right;
      border: 1px solid #2a5d6b;
      font-size: 15px;
      direction: rtl;
    }
    .story {
      color: #c1f0c1;
      font-style: italic;
      margin: 12px 0;
      padding: 12px;
      background: rgba(20, 50, 40, 0.3);
      border-radius: 12px;
      min-height: 45px;
      font-size: 16px;
    }
    .zone-title {
      background: rgba(40, 80, 60, 0.4);
      padding: 10px;
      border-radius: 12px;
      margin: 12px 0;
      font-weight: bold;
      color: #88e688;
      font-size: 18px;
    }
    .choices {
      margin: 18px 0;
      padding: 14px;
      background: rgba(40, 30, 60, 0.3);
      border-radius: 15px;
      border: 1px solid #5d4a7a;
    }
    .reputation {
      color: #ffd700;
      font-weight: bold;
    }
    .achievements {
      margin-top: 15px;
      padding: 10px;
      background: rgba(30, 30, 50, 0.4);
      border-radius: 12px;
      font-size: 14px;
    }
    .achievement-item {
      display: inline-block;
      background: rgba(255, 215, 0, 0.1);
      margin: 4px;
      padding: 4px 8px;
      border-radius: 8px;
      color: #ffd700;
    }
    .ending-screen {
      position: fixed;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      background: rgba(0, 0, 0, 0.9);
      display: flex;
      flex-direction: column;
      justify-content: center;
      align-items: center;
      z-index: 100;
      color: white;
      font-size: 24px;
      text-align: center;
      padding: 20px;
      display: none;
    }
    .ending-screen h2 {
      color: #ffd700;
      margin-bottom: 20px;
      font-size: 32px;
    }
    .ending-screen button {
      margin-top: 20px;
      font-size: 18px;
      padding: 12px 24px;
    }
  </style>
</head>
<body>
  <div class="container">
    <h1>ğŸ° Ù…Ù…Ø§Ù„Ùƒ Ø§Ù„Ø¸Ù„Ø§Ù„</h1>
    <div class="subtitle">Ù…ØºØ§Ù…Ø±Ø© Ø¹Ø±Ø¨ÙŠØ© Ø®ÙŠØ§Ù„ÙŠØ© ÙÙŠ Ù‚Ù„Ø¨ Ø§Ù„Ø£Ø³Ø§Ø·ÙŠØ±...</div>

    <div id="startScreen">
      <p>Ø§Ø®ØªØ± Ø¨Ø·Ù„ÙÙƒ Ù…Ù† Ø£Ø¨Ø·Ø§Ù„ Ø§Ù„Ù‚Ø¨ÙŠÙ„Ø©:</p>
      <button onclick="startGame('Ø§Ù„ÙØ§Ø±Ø³')">Ø§Ù„ÙØ§Ø±Ø³ âš”ï¸</button>
      <button onclick="startGame('Ø§Ù„Ø­ÙƒÙŠÙ…')">Ø§Ù„Ø­ÙƒÙŠÙ… ğŸ“œ</button>
      <button onclick="startGame('Ø§Ù„ØµÙŠØ§Ø¯')">Ø§Ù„ØµÙŠØ§Ø¯ ğŸ¹</button>
    </div>

    <div id="gameScreen" style="display:none;">
      <div class="stats">
        <div class="stat-item">Ø§Ù„Ø¨Ø·Ù„: <span id="heroName">â€”</span></div>
        <div class="stat-item">Ø§Ù„Ù…Ø³ØªÙˆÙ‰: <span id="level">1</span></div>
        <div class="stat-item">Ø§Ù„ØµØ­Ø©: <span id="heroHP">100</span>/<span id="maxHP">100</span> â¤ï¸</div>
        <div class="stat-item">Ø§Ù„Ù‡Ø¬ÙˆÙ…: <span id="heroAtk">15</span> ğŸ’¥</div>
        <div class="stat-item">Ø§Ù„Ø°Ù‡Ø¨: <span id="gold">0</span> ğŸ’°</div>
        <div class="stat-item">Ø§Ù„Ø³Ù…Ø¹Ø©: <span id="reputation" class="reputation">Ù…Ø­Ø§ÙŠØ¯</span> ğŸŒŸ</div>
      </div>

      <div class="zone-title" id="zoneTitle">Ø§Ù„ØºØ§Ø¨Ø© Ø§Ù„Ù…Ù„Ø¹ÙˆÙ†Ø©</div>

      <div class="story" id="storyText">Ø§Ù„ØºØ§Ø¨Ø© Ù‡Ø§Ø¯Ø¦Ø©... Ù„ÙƒÙ†Ùƒ ØªØ´Ø¹Ø± Ø£Ù† Ø´ÙŠØ¦Ù‹Ø§ ÙŠØ±Ø§Ù‚Ø¨Ùƒ Ù…Ù† Ø¨ÙŠÙ† Ø§Ù„Ø£Ø´Ø¬Ø§Ø±.</div>

      <div class="log" id="battleLog">Ø§Ø¨Ø¯Ø£ Ù…ØºØ§Ù…Ø±ØªÙƒ ÙÙŠ Ù…Ù…Ø§Ù„Ùƒ Ø§Ù„Ø¸Ù„Ø§Ù„...</div>

      <div style="margin: 15px 0;">
        <button class="zone-btn" onclick="changeZone('Ø§Ù„ØºØ§Ø¨Ø©')">ğŸŒ² Ø§Ù„ØºØ§Ø¨Ø©</button>
        <button class="zone-btn" onclick="changeZone('Ø§Ù„ÙˆØ§Ø­Ø©')">ğŸŒ´ Ø§Ù„ÙˆØ§Ø­Ø©</button>
        <button class="zone-btn" onclick="changeZone('Ø§Ù„Ø¬Ø¨Ø§Ù„')">â›°ï¸ Ø§Ù„Ø¬Ø¨Ø§Ù„</button>
      </div>

      <button onclick="explore()">âš”ï¸ Ø§Ø³ØªÙƒØ´Ù</button>
      <button onclick="upgrade('hp')">â¤ï¸ +20 ØµØ­Ø© (20 Ø°Ù‡Ø¨)</button>
      <button onclick="upgrade('atk')">ğŸ’¥ +5 Ù‡Ø¬ÙˆÙ… (25 Ø°Ù‡Ø¨)</button>
      <button onclick="showAchievements()">ğŸ† Ø¥Ù†Ø¬Ø§Ø²Ø§ØªÙŠ</button>
      <button onclick="resetGame()">ğŸ”„ Ø§Ø¨Ø¯Ø£ Ù…Ù† Ø¬Ø¯ÙŠØ¯</button>

      <div id="choicesSection" class="choices" style="display:none;"></div>
    </div>
  </div>

  <div id="endingScreen" class="ending-screen">
    <h2 id="endingTitle">Ù†Ù‡Ø§ÙŠØ© Ø§Ù„Ù…ØºØ§Ù…Ø±Ø©</h2>
    <p id="endingMessage">Ø´ÙƒØ±Ù‹Ø§ Ù„Ùƒ Ø¹Ù„Ù‰ Ù„Ø¹Ø¨Ùƒ!</p>
    <button onclick="resetFromEnding()">Ø§Ø¨Ø¯Ø£ Ù…ØºØ§Ù…Ø±Ø© Ø¬Ø¯ÙŠØ¯Ø©</button>
  </div>

  <script>
    let game = JSON.parse(localStorage.getItem('shadowKingdoms')) || {
      hero: null,
      gold: 0,
      wins: 0,
      currentZone: "Ø§Ù„ØºØ§Ø¨Ø©",
      reputation: 0,
      achievements: [],
      log: []
    };

    // Ù†Ø¸Ø§Ù… Ø§Ù„Ø¥Ù†Ø¬Ø§Ø²Ø§Øª
    const allAchievements = {
      forestMaster: { name: "ÙØ§ØªØ­ Ø§Ù„ØºØ§Ø¨Ø©", desc: "ÙØ² Ø¨Ù€ 3 Ù…Ø¹Ø§Ø±Ùƒ ÙÙŠ Ø§Ù„ØºØ§Ø¨Ø©", unlocked: false },
      oasisFriend: { name: "ØµØ¯ÙŠÙ‚ Ø§Ù„ÙˆØ§Ø­Ø©", desc: "Ø§Ø´ØªØ±Ù Ø³Ø­Ø±Ù‹Ø§ Ù…Ù† Ø§Ù„ØªØ§Ø¬Ø±", unlocked: false },
      braveSoul: { name: "Ø±ÙˆØ­ Ø´Ø¬Ø§Ø¹Ø©", desc: "Ø³Ù…Ø¹ØªÙƒ Ø´Ø¬Ø§Ø¹", unlocked: false },
      treasureHunter: { name: "ØµÙŠØ§Ø¯ Ø§Ù„ÙƒÙ†ÙˆØ²", desc: "Ø§Ø¬Ù…Ø¹ 150 Ø°Ù‡Ø¨", unlocked: false }
    };

    function unlockAchievement(key) {
      if (!game.achievements.includes(key) && allAchievements[key]) {
        game.achievements.push(key);
        log(`ğŸ† Ø¥Ù†Ø¬Ø§Ø² Ø¬Ø¯ÙŠØ¯: ${allAchievements[key].name}!`);
        saveGame();
      }
    }

    function showAchievements() {
      let msg = "Ø¥Ù†Ø¬Ø§Ø²Ø§ØªÙƒ:\n";
      if (game.achievements.length === 0) {
        msg += "Ù„Ø§ ØªÙˆØ¬Ø¯ Ø¥Ù†Ø¬Ø§Ø²Ø§Øª Ø¨Ø¹Ø¯. Ø§Ø³ØªÙƒØ´Ù Ø£ÙƒØ«Ø±!";
      } else {
        game.achievements.forEach(key => {
          msg += `â€¢ ${allAchievements[key].name}: ${allAchievements[key].desc}\n`;
        });
      }
      alert(msg);
    }

    function updateReputation(change) {
      game.reputation += change;
      if (game.reputation > 10) game.reputation = 10;
      if (game.reputation < -10) game.reputation = -10;
      if (game.reputation >= 7) unlockAchievement('braveSoul');
      saveGame();
    }

    function getReputationText() {
      if (game.reputation >= 7) return "Ø´Ø¬Ø§Ø¹";
      if (game.reputation >= 3) return "ÙƒØ±ÙŠÙ…";
      if (game.reputation <= -7) return "Ø¬Ø¨Ø§Ù†";
      if (game.reputation <= -3) return "Ø¬Ø´Ø¹";
      return "Ù…Ø­Ø§ÙŠØ¯";
    }

    const zones = {
      "Ø§Ù„ØºØ§Ø¨Ø©": {
        name: "Ø§Ù„ØºØ§Ø¨Ø© Ø§Ù„Ù…Ù„Ø¹ÙˆÙ†Ø©",
        story: [
          "ØªØ³Ù…Ø¹ ØµØ±ÙŠØ±Ù‹Ø§ Ø¨ÙŠÙ† Ø§Ù„Ø£ØºØµØ§Ù†... Ø´ÙŠØ¡ ÙŠÙ‚ØªØ±Ø¨! ğŸŒ²",
          "ÙˆØ¬Ø¯Øª Ø£Ø«Ø± Ø£Ù‚Ø¯Ø§Ù… ØºØ±ÙŠØ¨Ø© Ø¹Ù„Ù‰ Ø§Ù„ØªØ±Ø§Ø¨. ğŸ‘£",
          "Ø¶Ø¨Ø§Ø¨ ÙƒØ«ÙŠÙ ÙŠÙ„Ù Ø§Ù„Ù…ÙƒØ§Ù†. Ø§Ù„Ø±Ø¤ÙŠØ© Ø´Ø¨Ù‡ Ù…Ø¹Ø¯ÙˆÙ…Ø©... ğŸŒ«ï¸"
        ],
        monsters: [
          { name: "Ø°Ø¦Ø¨ Ø§Ù„Ø¶Ø¨Ø§Ø¨", hp: 30, atk: 8 },
          { name: "Ø´Ø¬Ø±Ø© Ø§Ù„ØºÙˆÙ„", hp: 50, atk: 12 },
          { name: "Ø§Ù„Ø¹Ù†ÙƒØ¨ÙˆØª Ø§Ù„Ø³Ø§Ù…", hp: 70, atk: 16 }
        ],
        events: [
          {
            text: "Ø³Ù…Ø¹Øª Ø¨ÙƒØ§Ø¡ Ø·ÙÙ„ Ù…Ù† Ø¨ÙŠÙ† Ø§Ù„Ø£Ø´Ø¬Ø§Ø±. Ù…Ø§Ø°Ø§ ØªÙØ¹Ù„ØŸ",
            choices: [
              { 
                text: "Ø£ØªØ¨Ø¹ Ø§Ù„ØµÙˆØª Ù„Ø£Ù†Ù‚Ø°Ù‡", 
                effect: () => { 
                  game.gold += 10; 
                  updateReputation(2);
                  log("Ø£Ù†Ù‚Ø°Øª Ø§Ù„Ø·ÙÙ„! (+10 Ø°Ù‡Ø¨ØŒ +Ø³Ù…Ø¹Ø© Ø´Ø¬Ø§Ø¹Ø©)");
                } 
              },
              { 
                text: "Ø£ØªØ¬Ø§Ù‡Ù„ Ø§Ù„ØµÙˆØª... Ù‚Ø¯ ÙŠÙƒÙˆÙ† ÙØ®Ù‹Ø§", 
                effect: () => { 
                  updateReputation(-1);
                  log("ØªØ±ÙƒØª Ø§Ù„ØµÙˆØª ÙˆØ±Ø§Ø¦Ùƒ. (-Ø³Ù…Ø¹Ø©)");
                } 
              }
            ]
          }
        ],
        npcs: [
          {
            name: "Ø§Ù„Ø¹Ø¬ÙˆØ² Ø§Ù„Ø­ÙƒÙŠÙ…",
            dialogue: "Ø§Ù„Ø³Ù„Ø§Ù… Ø¹Ù„ÙŠÙƒ... Ù‡Ù„ ØªØ¨Ø­Ø« Ø¹Ù† Ø§Ù„Ø­Ù‚ÙŠÙ‚Ø© Ø£Ù… Ø¹Ù† Ø§Ù„Ù‚ÙˆØ©ØŸ ğŸ“œ",
            choices: [
              { text: "Ø£Ø¨Ø­Ø« Ø¹Ù† Ø§Ù„Ø­Ù‚ÙŠÙ‚Ø©", effect: () => { updateReputation(1); log("Ø§Ù„Ø¹Ø¬ÙˆØ²: 'Ø§Ù„Ø­ÙƒÙ…Ø© Ù…Ø¹Ùƒ ÙŠØ§ Ø¨Ù†ÙŠ.'"); } },
              { text: "Ø£Ø¨Ø­Ø« Ø¹Ù† Ø§Ù„Ù‚ÙˆØ©", effect: () => { game.hero.atk += 2; log("Ø§Ù„Ø¹Ø¬ÙˆØ²: 'Ø§Ù„Ù‚ÙˆØ© Ø³ØªØ£ÙƒÙ„Ùƒ ÙŠÙˆÙ…Ù‹Ø§.'"); } }
            ]
          }
        ]
      },
      "Ø§Ù„ÙˆØ§Ø­Ø©": {
        name: "Ø§Ù„ÙˆØ§Ø­Ø© Ø§Ù„Ù…Ø­Ø±Ù‘Ù…Ø©",
        story: [
          "Ù†Ø®ÙŠÙ„ Ø¹ØªÙŠÙ‚ ÙŠØ­ÙŠØ· Ø¨Ù…Ø§Ø¡ Ø£Ø²Ø±Ù‚ Ù„Ø§Ù…Ø¹... Ù„ÙƒÙ† Ø§Ù„Ø­Ø°Ø±! ğŸŒ´",
          "Ø³Ù…Ø¹Øª ØµÙˆØª Ù†Ø§ÙŠ Ø¨Ø¹ÙŠØ¯... Ù…Ù† ÙŠØ¹Ø²ÙØŸ ğŸ¶",
          "Ø±Ù…Ø§Ù„ Ø°Ù‡Ø¨ÙŠØ© ØªÙ„Ù…Ø¹ ØªØ­Øª Ø§Ù„Ø´Ù…Ø³. ÙƒÙ†Ø² Ø£Ù… ÙØ®ØŸ ğŸ’"
        ],
        monsters: [
          { name: "Ø¹ÙØ±ÙŠØª Ø§Ù„Ø±Ù…Ø§Ù„", hp: 40, atk: 10 },
          { name: "Ø§Ù„Ø­ÙŠØ© Ø§Ù„Ø°Ù‡Ø¨ÙŠØ©", hp: 60, atk: 14 },
          { name: "Ø´ÙŠØ·Ø§Ù† Ø§Ù„ÙˆØ§Ø­Ø©", hp: 85, atk: 19 }
        ],
        events: [
          {
            text: "ØªØ§Ø¬Ø± ØºØ§Ù…Ø¶ ÙŠØ¹Ø±Ø¶ Ø¹Ù„ÙŠÙƒ Ø³Ø­Ø±Ù‹Ø§ Ù†Ø§Ø¯Ø±Ù‹Ø§ Ø¨Ù€ 30 Ø°Ù‡Ø¨. Ù‡Ù„ ØªØ´Ø±ÙŠÙ‡ØŸ",
            choices: [
              { 
                text: "Ø£Ø´ØªØ±ÙŠÙ‡", 
                effect: () => { 
                  if (game.gold >= 30) {
                    game.gold -= 30;
                    game.hero.hp = Math.min(game.hero.maxHp, game.hero.hp + 40);
                    unlockAchievement('oasisFriend');
                    log("Ø§Ù„Ø³Ø­Ø± Ø´ÙØ§Ù‡! (+40 ØµØ­Ø©)");
                  } else {
                    log("Ù„ÙŠØ³ Ù„Ø¯ÙŠÙƒ Ø°Ù‡Ø¨ ÙƒØ§ÙÙ!");
                  }
                } 
              },
              { 
                text: "Ø£Ø±ÙØ¶", 
                effect: () => { 
                  updateReputation(1);
                  log("Ø±ÙØ¶Øª Ø§Ù„Ø´Ø±Ø§Ø¡. Ø§Ù„ØªØ§Ø¬Ø± ÙŠØ­ØªØ±Ù… Ù‚Ø±Ø§Ø±Ùƒ (+Ø³Ù…Ø¹Ø© ÙƒØ±Ù…).");
                } 
              }
            ]
          }
        ],
        npcs: [
          {
            name: "Ø§Ù„ØªØ§Ø¬Ø± Ø§Ù„ØºØ§Ù…Ø¶",
            dialogue: "Ù„Ø¯ÙŠÙ‘ Ø£Ø³Ø±Ø§Ø±... Ù„ÙƒÙ†Ù‡Ø§ Ù„Ø§ ØªÙØ¨Ø§Ø¹ Ø¨Ø§Ù„Ø°Ù‡Ø¨ ÙˆØ­Ø¯Ù‡. ğŸ’°",
            choices: [
              { text: "Ø£Ø¹Ø·ÙŠÙƒ 20 Ø°Ù‡Ø¨ Ù…Ù‚Ø§Ø¨Ù„ Ø³Ø±", effect: () => { 
                  if (game.gold >= 20) {
                    game.gold -= 20;
                    game.wins += 1;
                    log("Ø§Ù„ØªØ§Ø¬Ø±: 'Ø§Ù„Ù…Ù„Ùƒ ÙŠØ®ØªØ¨Ø¦ ÙÙŠ Ø§Ù„Ø¬Ø¨Ø§Ù„...'");
                  } else {
                    log("Ù„ÙŠØ³ Ù„Ø¯ÙŠÙƒ Ø°Ù‡Ø¨ ÙƒØ§ÙÙ!");
                  }
                } 
              },
              { text: "Ù„Ø§ Ø£Ø«Ù‚ Ø¨Ùƒ", effect: () => { log("Ø§Ø¨ØªØ¹Ø¯ Ø§Ù„ØªØ§Ø¬Ø± Ø¨Ù†Ø¸Ø±Ø© ØºØ¶Ø¨."); } }
            ]
          }
        ]
      },
      "Ø§Ù„Ø¬Ø¨Ø§Ù„": {
        name: "Ø¬Ø¨Ø§Ù„ Ø§Ù„Ø¬Ù†",
        story: [
          "ØµØ®ÙˆØ± Ø´Ø§Ù‡Ù‚Ø© ØªÙ‡Ù…Ø³ Ø¨Ø£Ø³Ø±Ø§Ø± Ù‚Ø¯ÙŠÙ…Ø©. Ù‡Ù„ ØªØ¬Ø±Ø¤ØŸ â›°ï¸",
          "Ø±Ø£ÙŠØª Ù†ÙˆØ±Ù‹Ø§ Ø£Ø²Ø±Ù‚ ÙŠÙ„Ù…Ø¹ ÙÙŠ ÙƒÙ‡Ù Ø¨Ø¹ÙŠØ¯... ğŸ”®",
          "Ø§Ù„Ø±ÙŠØ§Ø­ ØªØ­Ù…Ù„ Ù‡Ù…Ø³Ø§Øª Ø¨Ù„ØºØ© Ù„Ù… ØªØ³Ù…Ø¹Ù‡Ø§ Ù…Ù† Ù‚Ø¨Ù„... ğŸŒ¬ï¸"
        ],
        monsters: [
          { name: "ØºÙˆÙ„ Ø§Ù„Ø¬Ø¨Ø§Ù„", hp: 55, atk: 13 },
          { name: "Ø§Ù„Ù†Ø³Ø± Ø§Ù„Ø³Ø§Ø­Ø±", hp: 75, atk: 17 },
          { name: "Ø­Ø§Ø±Ø³ Ø§Ù„ÙƒÙ‡Ù", hp: 100, atk: 22 }
        ],
        events: [
          {
            text: "Ø³Ù…Ø¹Øª ØµØ±Ø®Ø© Ø§Ø³ØªØºØ§Ø«Ø© Ù…Ù† ÙƒÙ‡Ù Ù…Ø¸Ù„Ù…. Ù‡Ù„ ØªØ¯Ø®Ù„ØŸ",
            choices: [
              { 
                text: "Ø£Ø¯Ø®Ù„ Ù„Ø¥Ù†Ù‚Ø§Ø° Ù…Ù† Ø¨Ø¯Ø§Ø®Ù„Ù‡", 
                effect: () => { 
                  game.wins += 1;
                  updateReputation(2);
                  log("Ø£Ù†Ù‚Ø°Øª Ø¹Ø¬ÙˆØ²Ù‹Ø§! (+1 Ø§Ù†ØªØµØ§Ø±ØŒ +Ø³Ù…Ø¹Ø© Ø´Ø¬Ø§Ø¹Ø©)");
                } 
              },
              { 
                text: "Ø£Ù†ØªØ¸Ø± Ø®Ø§Ø±Ø¬ Ø§Ù„ÙƒÙ‡Ù", 
                effect: () => { 
                  game.hero.hp -= 10;
                  updateReputation(-2);
                  log("Ø§Ù†ÙØ¬Ø± Ø§Ù„ÙƒÙ‡Ù! (-10 ØµØ­Ø©ØŒ -Ø³Ù…Ø¹Ø© Ø¬Ø¨Ù†)");
                } 
              }
            ]
          }
        ],
        npcs: [
          {
            name: "Ø§Ù„ÙØ§Ø±Ø³Ø© Ø§Ù„Ù…Ø¬Ù‡ÙˆÙ„Ø©",
            dialogue: "Ø£Ø¨Ø­Ø« Ø¹Ù† Ù…Ù† ÙŠØ³Ø§Ø¹Ø¯Ù†ÙŠ Ø¶Ø¯ Ù…Ù„Ùƒ Ø§Ù„Ø¸Ù„Ø§Ù„... Ù‡Ù„ Ø£Ù†Øª Ø¬Ø§Ù‡Ø²ØŸ ğŸ›¡ï¸",
            choices: [
              { text: "Ù†Ø¹Ù…ØŒ Ø³Ø£Ø³Ø§Ø¹Ø¯Ùƒ", effect: () => { 
                  updateReputation(3);
                  log("Ø§Ù„ÙØ§Ø±Ø³Ø©: 'Ø´ÙƒØ±Ø§Ù‹... Ø³Ù†ØªÙ‚Ø§Ø¨Ù„ ÙÙŠ Ø§Ù„Ù…Ø¹Ø±ÙƒØ© Ø§Ù„Ø£Ø®ÙŠØ±Ø©.'");
                } 
              },
              { text: "Ù„ÙŠØ³ Ø§Ù„Ø¢Ù†", effect: () => { 
                  updateReputation(-2);
                  log("Ø§Ù„ÙØ§Ø±Ø³Ø©: 'Ø§Ù„Ø®ÙˆÙ ÙŠÙ‚ÙˆØ¯Ùƒ... ÙˆØ¯Ø§Ø¹Ù‹Ø§.'");
                } 
              }
            ]
          }
        ]
      }
    };

    const boss = { name: "Ù…Ù„Ùƒ Ø§Ù„Ø¸Ù„Ø§Ù„", hp: 200, atk: 30 };

    function log(msg) {
      game.log.push(msg);
      if (game.log.length > 20) game.log.shift();
      document.getElementById('battleLog').innerHTML = game.log.join('<br>');
      document.getElementById('battleLog').scrollTop = document.getElementById('battleLog').scrollHeight;
      saveGame();
    }

    function getRandomStory() {
      const zoneData = zones[game.currentZone];
      return zoneData.story[Math.floor(Math.random() * zoneData.story.length)];
    }

    function showChoices(choices, eventText) {
      let choicesHTML = `<p>${eventText}</p>`;
      choices.forEach((choice, i) => {
        choicesHTML += `<button class="choice-btn" onclick="handleChoice(${i})">${choice.text}</button>`;
      });
      document.getElementById('choicesSection').innerHTML = choicesHTML;
      document.getElementById('choicesSection').style.display = 'block';
      window.currentChoices = choices;
    }

    function handleChoice(index) {
      const choice = window.currentChoices[index];
      choice.effect();
      document.getElementById('choicesSection').style.display = 'none';
      updateUI();
    }

    function meetNPC() {
      const zoneData = zones[game.currentZone];
      if (!zoneData.npcs || Math.random() > 0.4) return;
      const npc = zoneData.npcs[Math.floor(Math.random() * zoneData.npcs.length)];
      showChoices(npc.choices, `${npc.name} ÙŠÙ‚ÙˆÙ„: "${npc.dialogue}"`);
    }

    function updateUI() {
      if (!game.hero) return;
      document.getElementById('heroName').textContent = game.hero.name;
      document.getElementById('heroHP').textContent = game.hero.hp;
      document.getElementById('maxHP').textContent = game.hero.maxHp;
      document.getElementById('heroAtk').textContent = game.hero.atk;
      document.getElementById('gold').textContent = game.gold;
      document.getElementById('level').textContent = Math.floor(game.wins / 3) + 1;
      document.getElementById('reputation').textContent = getReputationText();
      
      const zoneData = zones[game.currentZone];
      document.getElementById('zoneTitle').textContent = zoneData.name;
      document.getElementById('storyText').textContent = getRandomStory();
    }

    function startGame(heroType) {
      let hp = 100, atk = 15;
      if (heroType === 'Ø§Ù„Ø­ÙƒÙŠÙ…') { hp = 130; atk = 12; }
      else if (heroType === 'Ø§Ù„ØµÙŠØ§Ø¯') { hp = 110; atk = 16; }

      game.hero = { name: heroType, maxHp: hp, hp: hp, atk: atk };
      game.gold = 0;
      game.wins = 0;
      game.reputation = 0;
      game.achievements = [];
      game.currentZone = "Ø§Ù„ØºØ§Ø¨Ø©";
      game.log = [];
      log(`Ù…Ø±Ø­Ø¨Ù‹Ø§ØŒ Ø£ÙŠÙ‡Ø§ ${heroType}! Ø¨Ø¯Ø£Øª Ø±Ø­Ù„ØªÙƒ ÙÙŠ Ù…Ù…Ø§Ù„Ùƒ Ø§Ù„Ø¸Ù„Ø§Ù„...`);
      updateUI();
      
      document.getElementById('startScreen').style.display = 'none';
      document.getElementById('gameScreen').style.display = 'block';
      saveGame();
    }

    function changeZone(zoneName) {
      if (!game.hero || game.hero.hp <= 0) return;
      game.currentZone = zoneName;
      log(`Ø§Ù†ØªÙ‚Ù„Øª Ø¥Ù„Ù‰: ${zones[zoneName].name}`);
      updateUI();
      document.getElementById('choicesSection').style.display = 'none';
    }

    function explore() {
      if (!game.hero || game.hero.hp <= 0) {
        log("Ù„Ù‚Ø¯ Ø³Ù‚Ø·Øª... Ø§Ø¨Ø¯Ø£ Ù…Ù† Ø¬Ø¯ÙŠØ¯.");
        return;
      }

      if (Math.random() > 0.6) {
        meetNPC();
        return;
      }

      if (game.wins >= 10) {
        endGame();
        return;
      }

      let monster;
      if (game.wins > 0 && game.wins % 5 === 0) {
        monster = JSON.parse(JSON.stringify(boss));
        log("âš ï¸ Ø¸Ù‡Ø± Ù…Ù„Ùƒ Ø§Ù„Ø¸Ù„Ø§Ù„! Ù‡Ø°Ù‡ Ù…Ø¹Ø±ÙƒØªÙƒ Ø§Ù„Ù…ØµÙŠØ±ÙŠØ©! ğŸ‘‘");
      } else {
        const zoneData = zones[game.currentZone];
        const monsters = zoneData.monsters;
        monster = JSON.parse(JSON.stringify(monsters[Math.floor(Math.random() * monsters.length)]));
        log(`Ø¸Ù‡Ø± ${monster.name}! ${monster.name.includes('Ø°Ø¦Ø¨') ? 'ğŸº' : monster.name.includes('Ø´Ø¬Ø±Ø©') ? 'ğŸŒ³' : 'ğŸ‘¹'}`);
      }

      let turn = 0;
      const interval = setInterval(() => {
        if (turn % 2 === 0) {
          monster.hp -= game.hero.atk;
          log(`Ù‡Ø§Ø¬Ù…Øª ${monster.name} Ø¨Ù€ ${game.hero.atk} Ø¶Ø±Ø±! ğŸ’¥`);
          if (monster.hp <= 0) {
            game.hero.hp = Math.min(game.hero.maxHp, game.hero.hp + 30);
            const reward = monster.name.includes("Ù…Ù„Ùƒ") ? 100 : Math.floor(Math.random() * 20) + 20;
            game.gold += reward;
            game.wins++;
            if (game.currentZone === "Ø§Ù„ØºØ§Ø¨Ø©" && game.wins >= 3) unlockAchievement('forestMaster');
            if (game.gold >= 150) unlockAchievement('treasureHunter');
            log(`Ù‡Ø²ÙÙ…Øª ${monster.name}! (+30 ØµØ­Ø©ØŒ +${reward} Ø°Ù‡Ø¨) ğŸ‰`);
            updateUI();
            clearInterval(interval);
            
            setTimeout(() => {
              const zoneData = zones[game.currentZone];
              if (zoneData.events && Math.random() > 0.3) {
                const event = zoneData.events[Math.floor(Math.random() * zoneData.events.length)];
                showChoices(event.choices, event.text);
              }
            }, 1500);
            return;
          }
        } else {
          game.hero.hp -= monster.atk;
          if (game.hero.hp < 0) game.hero.hp = 0;
          log(`${monster.name} Ù‡Ø§Ø¬Ù…Ùƒ Ø¨Ù€ ${monster.atk} Ø¶Ø±Ø±! ğŸ©¸`);
          if (game.hero.hp <= 0) {
            log("Ù„Ù‚Ø¯ Ø³Ù‚Ø·Øª ÙÙŠ Ù…Ù…Ø§Ù„Ùƒ Ø§Ù„Ø¸Ù„Ø§Ù„... Ø§Ù„Ø¸Ù„Ø§Ù… ÙŠÙ„ÙÙƒ. ğŸ’€");
            updateUI();
            clearInterval(interval);
            return;
          }
          updateUI();
        }
        turn++;
      }, 800);
    }

    function endGame() {
      let ending = "", title = "";
      const rep = game.reputation;
      if (rep >= 7) {
        title = "ğŸŒŸ Ø§Ù„Ù†Ù‡Ø§ÙŠØ© Ø§Ù„Ø¨Ø·ÙˆÙ„ÙŠØ©";
        ending = "Ø£Ù†Ù‚Ø°Øª Ø§Ù„Ù…Ù…Ù„ÙƒØ© ÙˆØµØ§Ø± Ø§Ø³Ù…Ùƒ Ø£Ø³Ø·ÙˆØ±Ø©! Ø³ÙŠØ±ÙˆÙŠ Ø§Ù„Ø¬Ø¯Ù‘Ø§Øª Ø­ÙƒØ§ÙŠØªÙƒ Ù„Ù„Ø£Ø­ÙØ§Ø¯.";
      } else if (rep <= -7) {
        title = "ğŸŒ‘ Ø§Ù„Ù†Ù‡Ø§ÙŠØ© Ø§Ù„Ù…Ø¸Ù„Ù…Ø©";
        ending = "ØªØ­Ø§Ù„ÙØª Ù…Ø¹ Ø§Ù„Ø¸Ù„Ø§Ù„... ÙˆØ£ØµØ¨Ø­Øª Ø£Ù†Øª Ø§Ù„Ù…Ù„Ùƒ Ø§Ù„Ø¬Ø¯ÙŠØ¯. Ù„ÙƒÙ† Ù‡Ù„ Ø§Ù„Ø³Ø¹Ø§Ø¯Ø© ÙÙŠ Ø§Ù„Ø¸Ù„Ø§Ù…ØŸ";
      } else if (game.gold >= 200) {
        title = "ğŸ’° Ø§Ù„Ù†Ù‡Ø§ÙŠØ© Ø§Ù„ØºÙ†ÙŠØ©";
        ending = "Ø¬Ù…Ø¹Øª Ø«Ø±ÙˆØ© Ù‡Ø§Ø¦Ù„Ø© ÙˆØªØ±ÙƒØª Ø§Ù„Ù…ØºØ§Ù…Ø±Ø§Øª. Ø¹Ø´Øª ÙÙŠ Ù‚ØµØ± Ù…Ù† Ø°Ù‡Ø¨... ÙˆØ­ÙŠØ¯Ù‹Ø§.";
      } else {
        title = "ğŸ•Šï¸ Ø§Ù„Ù†Ù‡Ø§ÙŠØ© Ø§Ù„Ø­ÙƒÙŠÙ…Ø©";
        ending = "ÙØ¶Ù‘Ù„Øª Ø§Ù„Ø³Ù„Ø§Ù… ÙˆØªØ±ÙƒØª Ø§Ù„Ø³ÙŠÙ. Ø¹Ø¯Øª Ù„Ù‚Ø±ÙŠØªÙƒ ØªØ­ÙƒÙŠ Ø§Ù„Ø­ÙƒØ§ÙŠØ§Øª Ù„Ù„Ø£Ø·ÙØ§Ù„.";
      }
      
      document.getElementById('endingTitle').textContent = title;
      document.getElementById('endingMessage').textContent = ending;
      document.getElementById('endingScreen').style.display = 'flex';
    }

    function resetFromEnding() {
      document.getElementById('endingScreen').style.display = 'none';
      resetGame();
    }

    function upgrade(type) {
      if (!game.hero || game.hero.hp <= 0) return;
      if (type === 'hp' && game.gold >= 20) {
        game.hero.maxHp += 20;
        game.hero.hp += 20;
        game.gold -= 20;
        log("Ø§Ø³ØªØ®Ø¯Ù…Øª Ø¹Ø´Ø¨Ø© Ø´ÙØ§Ø¡ Ø£Ø¨Ø¯ÙŠØ©! (+20 ØµØ­Ø© Ø¯Ø§Ø¦Ù…Ø©) ğŸŒ¿");
      } else if (type === 'atk' && game.gold >= 25) {
        game.hero.atk += 5;
        game.gold -= 25;
        log("Ø­Ø³Ù‘Ù†Øª Ø³Ù„Ø§Ø­Ùƒ! (+5 Ù‡Ø¬ÙˆÙ…) âš”ï¸");
      } else {
        log("Ù„ÙŠØ³ Ù„Ø¯ÙŠÙƒ Ø°Ù‡Ø¨ ÙƒØ§ÙÙ! ğŸ’°");
      }
      updateUI();
      saveGame();
    }

    function saveGame() {
      localStorage.setItem('shadowKingdoms', JSON.stringify(game));
    }

    function resetGame() {
      localStorage.removeItem('shadowKingdoms');
      game = { hero: null, gold: 0, wins: 0, currentZone: "Ø§Ù„ØºØ§Ø¨Ø©", reputation: 0, achievements: [], log: [] };
      document.getElementById('startScreen').style.display = 'block';
      document.getElementById('gameScreen').style.display = 'none';
      document.getElementById('endingScreen').style.display = 'none';
    }

    if (game.hero) {
      document.getElementById('startScreen').style.display = 'none';
      document.getElementById('gameScreen').style.display = 'block';
      updateUI();
      document.getElementById('battleLog').innerHTML = game.log.join('<br>');
    }
  </script>
</body>
</html>
